<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件模型 | 博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="关均江的博客">
    
    <link rel="preload" href="/website/assets/css/0.styles.9986bf3e.css" as="style"><link rel="preload" href="/website/assets/js/app.72d1cbcf.js" as="script"><link rel="preload" href="/website/assets/js/2.9fa17cc6.js" as="script"><link rel="preload" href="/website/assets/js/103.e7992512.js" as="script"><link rel="prefetch" href="/website/assets/js/10.1b01f282.js"><link rel="prefetch" href="/website/assets/js/100.543673e7.js"><link rel="prefetch" href="/website/assets/js/101.5df521b0.js"><link rel="prefetch" href="/website/assets/js/102.2d225125.js"><link rel="prefetch" href="/website/assets/js/104.e77b9c4a.js"><link rel="prefetch" href="/website/assets/js/105.66e8fb54.js"><link rel="prefetch" href="/website/assets/js/106.0708d250.js"><link rel="prefetch" href="/website/assets/js/107.3dbd61c3.js"><link rel="prefetch" href="/website/assets/js/108.9bb11899.js"><link rel="prefetch" href="/website/assets/js/109.2adc1b88.js"><link rel="prefetch" href="/website/assets/js/11.db76f0e7.js"><link rel="prefetch" href="/website/assets/js/110.948b2442.js"><link rel="prefetch" href="/website/assets/js/111.fc12f452.js"><link rel="prefetch" href="/website/assets/js/112.2125a339.js"><link rel="prefetch" href="/website/assets/js/113.5f8c8ce8.js"><link rel="prefetch" href="/website/assets/js/114.a993e2f7.js"><link rel="prefetch" href="/website/assets/js/115.aa9431f2.js"><link rel="prefetch" href="/website/assets/js/116.0823f9ef.js"><link rel="prefetch" href="/website/assets/js/117.16da61d4.js"><link rel="prefetch" href="/website/assets/js/118.ea5fc0c1.js"><link rel="prefetch" href="/website/assets/js/119.74080c63.js"><link rel="prefetch" href="/website/assets/js/12.6c555b8b.js"><link rel="prefetch" href="/website/assets/js/120.8d79b5d4.js"><link rel="prefetch" href="/website/assets/js/121.c5193059.js"><link rel="prefetch" href="/website/assets/js/122.427994df.js"><link rel="prefetch" href="/website/assets/js/123.9584cc3e.js"><link rel="prefetch" href="/website/assets/js/124.7ab1beb8.js"><link rel="prefetch" href="/website/assets/js/125.3f0a7d4a.js"><link rel="prefetch" href="/website/assets/js/126.426d7ab2.js"><link rel="prefetch" href="/website/assets/js/127.ab3036a6.js"><link rel="prefetch" href="/website/assets/js/128.52766355.js"><link rel="prefetch" href="/website/assets/js/129.a6880451.js"><link rel="prefetch" href="/website/assets/js/13.8c951941.js"><link rel="prefetch" href="/website/assets/js/130.81191a19.js"><link rel="prefetch" href="/website/assets/js/131.0b5c9199.js"><link rel="prefetch" href="/website/assets/js/132.8518d9c6.js"><link rel="prefetch" href="/website/assets/js/133.aa21f51d.js"><link rel="prefetch" href="/website/assets/js/134.cd85131d.js"><link rel="prefetch" href="/website/assets/js/135.29ae6dd5.js"><link rel="prefetch" href="/website/assets/js/136.53901f75.js"><link rel="prefetch" href="/website/assets/js/137.4c3da7ae.js"><link rel="prefetch" href="/website/assets/js/138.e4443560.js"><link rel="prefetch" href="/website/assets/js/139.27d5bf81.js"><link rel="prefetch" href="/website/assets/js/14.6fbaea41.js"><link rel="prefetch" href="/website/assets/js/15.6961313d.js"><link rel="prefetch" href="/website/assets/js/16.f970f894.js"><link rel="prefetch" href="/website/assets/js/17.4ca05b49.js"><link rel="prefetch" href="/website/assets/js/18.8e020cc9.js"><link rel="prefetch" href="/website/assets/js/19.2a72c605.js"><link rel="prefetch" href="/website/assets/js/20.4d9c76cf.js"><link rel="prefetch" href="/website/assets/js/21.fb960aa3.js"><link rel="prefetch" href="/website/assets/js/22.8bfb8ff6.js"><link rel="prefetch" href="/website/assets/js/23.6c48ba2f.js"><link rel="prefetch" href="/website/assets/js/24.20bd2b52.js"><link rel="prefetch" href="/website/assets/js/25.9ea88fef.js"><link rel="prefetch" href="/website/assets/js/26.b119d6b4.js"><link rel="prefetch" href="/website/assets/js/27.9c150cbd.js"><link rel="prefetch" href="/website/assets/js/28.384ae726.js"><link rel="prefetch" href="/website/assets/js/29.0bdf71cf.js"><link rel="prefetch" href="/website/assets/js/3.68e5f300.js"><link rel="prefetch" href="/website/assets/js/30.c3d26c55.js"><link rel="prefetch" href="/website/assets/js/31.c1340cd9.js"><link rel="prefetch" href="/website/assets/js/32.fd88c40a.js"><link rel="prefetch" href="/website/assets/js/33.1c1c4895.js"><link rel="prefetch" href="/website/assets/js/34.1724715f.js"><link rel="prefetch" href="/website/assets/js/35.581d5cf8.js"><link rel="prefetch" href="/website/assets/js/36.d8870d15.js"><link rel="prefetch" href="/website/assets/js/37.3e30ed1f.js"><link rel="prefetch" href="/website/assets/js/38.64ac1205.js"><link rel="prefetch" href="/website/assets/js/39.c3c8ad50.js"><link rel="prefetch" href="/website/assets/js/4.eef8e9a7.js"><link rel="prefetch" href="/website/assets/js/40.4ad40d3c.js"><link rel="prefetch" href="/website/assets/js/41.5a0b4386.js"><link rel="prefetch" href="/website/assets/js/42.bbe43f8e.js"><link rel="prefetch" href="/website/assets/js/43.e7ecd95c.js"><link rel="prefetch" href="/website/assets/js/44.c62c5169.js"><link rel="prefetch" href="/website/assets/js/45.9e102c4c.js"><link rel="prefetch" href="/website/assets/js/46.554ac26e.js"><link rel="prefetch" href="/website/assets/js/47.b514d671.js"><link rel="prefetch" href="/website/assets/js/48.d7658615.js"><link rel="prefetch" href="/website/assets/js/49.d1002785.js"><link rel="prefetch" href="/website/assets/js/5.bdf0d823.js"><link rel="prefetch" href="/website/assets/js/50.78f1be7f.js"><link rel="prefetch" href="/website/assets/js/51.750d5ede.js"><link rel="prefetch" href="/website/assets/js/52.b1eb51e5.js"><link rel="prefetch" href="/website/assets/js/53.18ea93e6.js"><link rel="prefetch" href="/website/assets/js/54.a0acaaf0.js"><link rel="prefetch" href="/website/assets/js/55.32622c7e.js"><link rel="prefetch" href="/website/assets/js/56.b033037d.js"><link rel="prefetch" href="/website/assets/js/57.622415f0.js"><link rel="prefetch" href="/website/assets/js/58.093c795b.js"><link rel="prefetch" href="/website/assets/js/59.69c365a9.js"><link rel="prefetch" href="/website/assets/js/6.744a911e.js"><link rel="prefetch" href="/website/assets/js/60.6197bf91.js"><link rel="prefetch" href="/website/assets/js/61.39fd2d66.js"><link rel="prefetch" href="/website/assets/js/62.2ba6ac21.js"><link rel="prefetch" href="/website/assets/js/63.d53cca77.js"><link rel="prefetch" href="/website/assets/js/64.d6f4d1ec.js"><link rel="prefetch" href="/website/assets/js/65.0249b48c.js"><link rel="prefetch" href="/website/assets/js/66.75a33053.js"><link rel="prefetch" href="/website/assets/js/67.c690faed.js"><link rel="prefetch" href="/website/assets/js/68.8b33d61c.js"><link rel="prefetch" href="/website/assets/js/69.c0f481dc.js"><link rel="prefetch" href="/website/assets/js/7.3a413927.js"><link rel="prefetch" href="/website/assets/js/70.c3b94e63.js"><link rel="prefetch" href="/website/assets/js/71.44f80a16.js"><link rel="prefetch" href="/website/assets/js/72.cfcdbef4.js"><link rel="prefetch" href="/website/assets/js/73.28e36af8.js"><link rel="prefetch" href="/website/assets/js/74.79364fe9.js"><link rel="prefetch" href="/website/assets/js/75.d0e19b09.js"><link rel="prefetch" href="/website/assets/js/76.b94059df.js"><link rel="prefetch" href="/website/assets/js/77.dfc7549d.js"><link rel="prefetch" href="/website/assets/js/78.650f66aa.js"><link rel="prefetch" href="/website/assets/js/79.2e541360.js"><link rel="prefetch" href="/website/assets/js/8.e905a1ae.js"><link rel="prefetch" href="/website/assets/js/80.e9581b2f.js"><link rel="prefetch" href="/website/assets/js/81.11b4ab4e.js"><link rel="prefetch" href="/website/assets/js/82.a9e0d134.js"><link rel="prefetch" href="/website/assets/js/83.e3429019.js"><link rel="prefetch" href="/website/assets/js/84.e7252f94.js"><link rel="prefetch" href="/website/assets/js/85.8cd66f33.js"><link rel="prefetch" href="/website/assets/js/86.67021a51.js"><link rel="prefetch" href="/website/assets/js/87.f4746338.js"><link rel="prefetch" href="/website/assets/js/88.5f00831c.js"><link rel="prefetch" href="/website/assets/js/89.e1b02879.js"><link rel="prefetch" href="/website/assets/js/9.149fa029.js"><link rel="prefetch" href="/website/assets/js/90.5e3a8e06.js"><link rel="prefetch" href="/website/assets/js/91.fe3cd72f.js"><link rel="prefetch" href="/website/assets/js/92.38113950.js"><link rel="prefetch" href="/website/assets/js/93.d7fe4dd2.js"><link rel="prefetch" href="/website/assets/js/94.bfbab9a5.js"><link rel="prefetch" href="/website/assets/js/95.4c1a3c2e.js"><link rel="prefetch" href="/website/assets/js/96.747d45b5.js"><link rel="prefetch" href="/website/assets/js/97.9920b8b0.js"><link rel="prefetch" href="/website/assets/js/98.93be639f.js"><link rel="prefetch" href="/website/assets/js/99.b4185469.js">
    <link rel="stylesheet" href="/website/assets/css/0.styles.9986bf3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/website/" class="home-link router-link-active"><!----> <span class="site-name">博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>入门篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>运算符</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>语法专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>标准库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>面向对象编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>异步操作</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>DOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>事件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/website/javascript/events/eventtarget.html" class="sidebar-link">EventTarget 接口</a></li><li><a href="/website/javascript/events/model.html" aria-current="page" class="active sidebar-link">事件模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#监听函数" class="sidebar-link">监听函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#html-的-on-属性" class="sidebar-link">HTML 的 on- 属性</a></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#元素节点的事件属性" class="sidebar-link">元素节点的事件属性</a></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#eventtarget-addeventlistener" class="sidebar-link">EventTarget.addEventListener()</a></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#小结" class="sidebar-link">小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#this-的指向" class="sidebar-link">this 的指向</a></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#事件的传播" class="sidebar-link">事件的传播</a></li><li class="sidebar-sub-header"><a href="/website/javascript/events/model.html#事件的代理" class="sidebar-link">事件的代理</a></li></ul></li><li><a href="/website/javascript/events/event.html" class="sidebar-link">Event 对象</a></li><li><a href="/website/javascript/events/mouse.html" class="sidebar-link">鼠标事件</a></li><li><a href="/website/javascript/events/keyboard.html" class="sidebar-link">键盘事件</a></li><li><a href="/website/javascript/events/progress.html" class="sidebar-link">进度事件</a></li><li><a href="/website/javascript/events/form.html" class="sidebar-link">表单事件</a></li><li><a href="/website/javascript/events/touch.html" class="sidebar-link">触摸事件</a></li><li><a href="/website/javascript/events/drag.html" class="sidebar-link">拖拉事件</a></li><li><a href="/website/javascript/events/common.html" class="sidebar-link">其他常见事件</a></li><li><a href="/website/javascript/events/globaleventhandlers.html" class="sidebar-link">GlobalEventHandlers 接口</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>浏览器模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>附录：网页元素接口</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="事件模型"><a href="#事件模型" class="header-anchor">#</a> 事件模型</h1> <h2 id="监听函数"><a href="#监听函数" class="header-anchor">#</a> 监听函数</h2> <p>浏览器的事件模型，就是通过监听函数（listener）对事件做出反应。事件发生后，浏览器监听到了这个事件，就会执行对应的监听函数。这是事件驱动编程模式（event-driven）的主要编程方式。</p> <p>JavaScript 有三种方法，可以为事件绑定监听函数。</p> <h3 id="html-的-on-属性"><a href="#html-的-on-属性" class="header-anchor">#</a> HTML 的 on- 属性</h3> <p>HTML 语言允许在元素的属性中，直接定义某些事件的监听代码。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doSomething()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console.log(<span class="token punctuation">'</span>触发事件<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面代码为<code>body</code>节点的<code>load</code>事件、<code>div</code>节点的<code>click</code>事件，指定了监听代码。一旦事件发生，就会执行这段代码。</p> <p>元素的事件监听属性，都是<code>on</code>加上事件名，比如<code>onload</code>就是<code>on + load</code>，表示<code>load</code>事件的监听代码。</p> <p>注意，这些属性的值是将会执行的代码，而不是一个函数。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 正确 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doSomething()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 错误 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doSomething<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一旦指定的事件发生，<code>on-</code>属性的值是原样传入 JavaScript 引擎执行。因此如果要执行函数，不要忘记加上一对圆括号。</p> <p>使用这个方法指定的监听代码，只会在冒泡阶段触发。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console.log(2)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console.log(1)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面代码中，<code>&lt;button&gt;</code>是<code>&lt;div&gt;</code>的子元素。<code>&lt;button&gt;</code>的<code>click</code>事件，也会触发<code>&lt;div&gt;</code>的<code>click</code>事件。由于<code>on-</code>属性的监听代码，只在冒泡阶段触发，所以点击结果是先输出<code>1</code>，再输出<code>2</code>，即事件从子元素开始冒泡到父元素。</p> <p>直接设置<code>on-</code>属性，与通过元素节点的<code>setAttribute</code>方法设置<code>on-</code>属性，效果是一样的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'onclick'</span><span class="token punctuation">,</span> <span class="token string">'doSomething()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token comment">// &lt;Element onclick=&quot;doSomething()&quot;&gt;</span>
</code></pre></div><h3 id="元素节点的事件属性"><a href="#元素节点的事件属性" class="header-anchor">#</a> 元素节点的事件属性</h3> <p>元素节点对象的事件属性，同样可以指定监听函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>onload <span class="token operator">=</span> doSomething<span class="token punctuation">;</span>

div<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触发事件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用这个方法指定的监听函数，也是只会在冒泡阶段触发。</p> <p>注意，这种方法与 HTML 的<code>on-</code>属性的差异是，它的值是函数名（<code>doSomething</code>），而不像后者，必须给出完整的监听代码（<code>doSomething()</code>）。</p> <h3 id="eventtarget-addeventlistener"><a href="#eventtarget-addeventlistener" class="header-anchor">#</a> EventTarget.addEventListener()</h3> <p>所有 DOM 节点实例都有<code>addEventListener</code>方法，用来为该节点定义事件的监听函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> doSomething<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>addEventListener</code>方法的详细介绍，参见<code>EventTarget</code>章节。</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>上面三种方法，第一种“HTML 的 on- 属性”，违反了 HTML 与 JavaScript 代码相分离的原则，将两者写在一起，不利于代码分工，因此不推荐使用。</p> <p>第二种“元素节点的事件属性”的缺点在于，同一个事件只能定义一个监听函数，也就是说，如果定义两次<code>onclick</code>属性，后一次定义会覆盖前一次。因此，也不推荐使用。</p> <p>第三种<code>EventTarget.addEventListener</code>是推荐的指定监听函数的方法。它有如下优点：</p> <ul><li>同一个事件可以添加多个监听函数。</li> <li>能够指定在哪个阶段（捕获阶段还是冒泡阶段）触发监听函数。</li> <li>除了 DOM 节点，其他对象（比如<code>window</code>、<code>XMLHttpRequest</code>等）也有这个接口，它等于是整个 JavaScript 统一的监听函数接口。</li></ul> <h2 id="this-的指向"><a href="#this-的指向" class="header-anchor">#</a> this 的指向</h2> <p>监听函数内部的<code>this</code>指向触发事件的那个元素节点。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>console.log(this.id)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>执行上面代码，点击后会输出<code>btn</code>。</p> <p>其他两种监听函数的写法，<code>this</code>的指向也是如此。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// HTML 代码如下</span>
<span class="token comment">// &lt;button id=&quot;btn&quot;&gt;点击&lt;/button&gt;</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写法一</span>
btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 写法二</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'click'</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面两种写法，点击按钮以后也是输出<code>btn</code>。</p> <h2 id="事件的传播"><a href="#事件的传播" class="header-anchor">#</a> 事件的传播</h2> <p>一个事件发生后，会在子元素和父元素之间传播（propagation）。这种传播分成三个阶段。</p> <ul><li><strong>第一阶段</strong>：从<code>window</code>对象传导到目标节点（上层传到底层），称为“捕获阶段”（capture phase）。</li> <li><strong>第二阶段</strong>：在目标节点上触发，称为“目标阶段”（target phase）。</li> <li><strong>第三阶段</strong>：从目标节点传导回<code>window</code>对象（从底层传回上层），称为“冒泡阶段”（bubbling phase）。</li></ul> <p>这种三阶段的传播模型，使得同一个事件会在多个节点上触发。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面代码中，<code>&lt;div&gt;</code>节点之中有一个<code>&lt;p&gt;</code>节点。</p> <p>如果对这两个节点，都设置<code>click</code>事件的监听函数（每个节点的捕获阶段和冒泡阶段，各设置一个监听函数），共计设置四个监听函数。然后，对<code>&lt;p&gt;</code>点击，<code>click</code>事件会触发四次。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> phases <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'capture'</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token string">'target'</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token string">'bubble'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tag <span class="token operator">=</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>tagName<span class="token punctuation">;</span>
  <span class="token keyword">var</span> phase <span class="token operator">=</span> phases<span class="token punctuation">[</span>event<span class="token punctuation">.</span>eventPhase<span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Tag: '&quot;</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">&quot;'. EventPhase: '&quot;</span> <span class="token operator">+</span> phase <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 点击以后的结果</span>
<span class="token comment">// Tag: 'DIV'. EventPhase: 'capture'</span>
<span class="token comment">// Tag: 'P'. EventPhase: 'target'</span>
<span class="token comment">// Tag: 'P'. EventPhase: 'target'</span>
<span class="token comment">// Tag: 'DIV'. EventPhase: 'bubble'</span>
</code></pre></div><p>上面代码表示，<code>click</code>事件被触发了四次：<code>&lt;div&gt;</code>节点的捕获阶段和冒泡阶段各1次，<code>&lt;p&gt;</code>节点的目标阶段触发了2次。</p> <ol><li>捕获阶段：事件从<code>&lt;div&gt;</code>向<code>&lt;p&gt;</code>传播时，触发<code>&lt;div&gt;</code>的<code>click</code>事件；</li> <li>目标阶段：事件从<code>&lt;div&gt;</code>到达<code>&lt;p&gt;</code>时，触发<code>&lt;p&gt;</code>的<code>click</code>事件；</li> <li>冒泡阶段：事件从<code>&lt;p&gt;</code>传回<code>&lt;div&gt;</code>时，再次触发<code>&lt;div&gt;</code>的<code>click</code>事件。</li></ol> <p>其中，<code>&lt;p&gt;</code>节点有两个监听函数（<code>addEventListener</code>方法第三个参数的不同，会导致绑定两个监听函数），因此它们都会因为<code>click</code>事件触发一次。所以，<code>&lt;p&gt;</code>会在<code>target</code>阶段有两次输出。</p> <p>注意，浏览器总是假定<code>click</code>事件的目标节点，就是点击位置嵌套最深的那个节点（本例是<code>&lt;div&gt;</code>节点里面的<code>&lt;p&gt;</code>节点）。所以，<code>&lt;p&gt;</code>节点的捕获阶段和冒泡阶段，都会显示为<code>target</code>阶段。</p> <p>事件传播的最上层对象是<code>window</code>，接着依次是<code>document</code>，<code>html</code>（<code>document.documentElement</code>）和<code>body</code>（<code>document.body</code>）。也就是说，上例的事件传播顺序，在捕获阶段依次为<code>window</code>、<code>document</code>、<code>html</code>、<code>body</code>、<code>div</code>、<code>p</code>，在冒泡阶段依次为<code>p</code>、<code>div</code>、<code>body</code>、<code>html</code>、<code>document</code>、<code>window</code>。</p> <h2 id="事件的代理"><a href="#事件的代理" class="header-anchor">#</a> 事件的代理</h2> <p>由于事件会在冒泡阶段向上传播到父节点，因此可以把子节点的监听函数定义在父节点上，由父节点的监听函数统一处理多个子元素的事件。这种方法叫做事件的代理（delegation）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// some code</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>click</code>事件的监听函数定义在<code>&lt;ul&gt;</code>节点，但是实际上，它处理的是子节点<code>&lt;li&gt;</code>的<code>click</code>事件。这样做的好处是，只要定义一个监听函数，就能处理多个子节点的事件，而不用在每个<code>&lt;li&gt;</code>节点上定义监听函数。而且以后再添加子节点，监听函数依然有效。</p> <p>如果希望事件到某个节点为止，不再传播，可以使用事件对象的<code>stopPropagation</code>方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 事件传播到 p 元素后，就不再向下传播了</span>
p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 事件冒泡到 p 元素后，就不再向上冒泡了</span>
p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>stopPropagation</code>方法分别在捕获阶段和冒泡阶段，阻止了事件的传播。</p> <p>但是，<code>stopPropagation</code>方法只会阻止事件的传播，不会阻止该事件触发<code>&lt;p&gt;</code>节点的其他<code>click</code>事件的监听函数。也就是说，不是彻底取消<code>click</code>事件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 会触发</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>p</code>元素绑定了两个<code>click</code>事件的监听函数。<code>stopPropagation</code>方法只能阻止这个事件的传播，不能取消这个事件，因此，第二个监听函数会触发。输出结果会先是1，然后是2。</p> <p>如果想要彻底取消该事件，不再触发后面所有<code>click</code>的监听函数，可以使用<code>stopImmediatePropagation</code>方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不会被触发</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>stopImmediatePropagation</code>方法可以彻底取消这个事件，使得后面绑定的所有<code>click</code>监听函数都不再触发。所以，只会输出1，不会输出2。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/website/javascript/events/eventtarget.html" class="prev">
        EventTarget 接口
      </a></span> <span class="next"><a href="/website/javascript/events/event.html">
        Event 对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/website/assets/js/app.72d1cbcf.js" defer></script><script src="/website/assets/js/2.9fa17cc6.js" defer></script><script src="/website/assets/js/103.e7992512.js" defer></script>
  </body>
</html>
